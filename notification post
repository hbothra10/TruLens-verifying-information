import { useState } from 'react';
import { Send, Sparkles, Copy } from 'lucide-react';

interface NotificationPostProps {
  onAnalyze: (notification: string, source: string) => void;
  analyzing: boolean;
}

const COMMON_APPS = [
  { id: 'whatsapp', name: 'WhatsApp', icon: 'üí¨' },
  { id: 'telegram', name: 'Telegram', icon: '‚úàÔ∏è' },
  { id: 'instagram', name: 'Instagram', icon: 'üì∑' },
  { id: 'facebook', name: 'Facebook', icon: 'üë•' },
  { id: 'twitter', name: 'Twitter/X', icon: 'üê¶' },
  { id: 'tiktok', name: 'TikTok', icon: 'üéµ' },
  { id: 'other', name: 'Other', icon: 'üì±' },
];

export default function NotificationPost({ onAnalyze, analyzing }: NotificationPostProps) {
  const [notification, setNotification] = useState('');
  const [selectedSource, setSelectedSource] = useState('whatsapp');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (notification.trim() && !analyzing) {
      onAnalyze(notification.trim(), selectedSource);
    }
  };

  const handlePaste = async () => {
    try {
      const text = await navigator.clipboard.readText();
      setNotification(text);
    } catch (error) {
      console.error('Failed to read clipboard:', error);
    }
  };

  const exampleNotifications = [
    "üö® BREAKING: Government announces mandatory vaccine passes for all citizens starting next week. Share this before it gets deleted!",
    "URGENT: Banks will freeze all accounts on Friday for system maintenance. Withdraw your money NOW!!! üí∞üí∞üí∞",
    "Scientists confirm 5G towers cause serious health problems. The truth they don't want you to know! üì°‚ö†Ô∏è"
  ];

  return (
    <section className="py-16 px-4">
      <div className="max-w-4xl mx-auto">
        <div className="text-center mb-8">
          <div className="inline-flex items-center space-x-2 bg-purple-500/10 border border-purple-400/30 rounded-full px-4 py-2 mb-6">
            <Sparkles className="w-4 h-4 text-purple-400" />
            <span className="text-purple-400 text-sm font-medium">AI-Powered Message Verification</span>
          </div>
          <h2 className="text-3xl font-bold text-white mb-4">Check Forwarded Messages</h2>
          <p className="text-slate-300">Verify messages from WhatsApp, Telegram, Instagram, and other social apps</p>
        </div>

        <form onSubmit={handleSubmit} className="bg-slate-800/50 backdrop-blur-md rounded-2xl p-8 border border-slate-700/50">
          <div className="mb-6">
            <label className="block text-white font-semibold mb-3">
              Select Message Source
            </label>
            <div className="grid grid-cols-4 sm:grid-cols-7 gap-2 mb-6">
              {COMMON_APPS.map((app) => (
                <button
                  key={app.id}
                  type="button"
                  onClick={() => setSelectedSource(app.id)}
                  className={`p-3 rounded-lg border-2 transition-all duration-200 flex flex-col items-center justify-center space-y-1 ${
                    selectedSource === app.id
                      ? 'border-purple-500 bg-purple-500/20'
                      : 'border-slate-600 bg-slate-900/50 hover:border-slate-500'
                  }`}
                >
                  <span className="text-2xl">{app.icon}</span>
                  <span className="text-xs text-slate-300 font-medium">
                    {app.name}
                  </span>
                </button>
              ))}
            </div>
          </div>

          <div className="mb-6">
            <div className="flex items-center justify-between mb-3">
              <label htmlFor="notification-input" className="block text-white font-semibold">
                Paste Message or Notification
              </label>
              <button
                type="button"
                onClick={handlePaste}
                className="flex items-center space-x-1 text-xs text-purple-400 hover:text-purple-300 transition-colors"
              >
                <Copy className="w-3 h-3" />
                <span>Paste from clipboard</span>
              </button>
            </div>
            <textarea
              id="notification-input"
              value={notification}
              onChange={(e) => setNotification(e.target.value)}
              placeholder="Paste the message you want to verify here...

Example:
üö® BREAKING NEWS: [Suspicious claim here]
Forward to everyone before it gets deleted!!!"
              className="w-full h-64 bg-slate-900/50 border border-slate-600 rounded-xl p-4 text-white placeholder-slate-400 focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20 transition-all resize-none"
              disabled={analyzing}
              required
            />
            <div className="flex items-center justify-between mt-2">
              <p className="text-slate-400 text-sm">
                {notification.length} characters
              </p>
              {notification.length > 0 && (
                <button
                  type="button"
                  onClick={() => setNotification('')}
                  className="text-slate-400 hover:text-slate-300 text-sm"
                >
                  Clear
                </button>
              )}
            </div>
          </div>

          <button
            type="submit"
            disabled={!notification.trim() || analyzing}
            className="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 disabled:from-slate-600 disabled:to-slate-700 disabled:cursor-not-allowed text-white font-semibold rounded-xl transition-all duration-200 transform hover:scale-105 disabled:transform-none flex items-center justify-center space-x-2"
          >
            {analyzing ? (
              <>
                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                <span>Verifying Message...</span>
              </>
            ) : (
              <>
                <Send className="w-5 h-5" />
                <span>Verify Message</span>
              </>
            )}
          </button>
        </form>

        <div className="mt-8 bg-purple-500/10 border border-purple-400/30 rounded-xl p-6">
          <h3 className="text-white font-semibold mb-3">What we check:</h3>
          <ul className="space-y-2 text-slate-300 mb-6">
            <li className="flex items-start space-x-2">
              <span className="text-purple-400 mt-1">‚Ä¢</span>
              <span>Sensationalist language and emotional manipulation</span>
            </li>
            <li className="flex items-start space-x-2">
              <span className="text-purple-400 mt-1">‚Ä¢</span>
              <span>Fact-checking against official government sources</span>
            </li>
            <li className="flex items-start space-x-2">
              <span className="text-purple-400 mt-1">‚Ä¢</span>
              <span>Detection of viral misinformation patterns</span>
            </li>
            <li className="flex items-start space-x-2">
              <span className="text-purple-400 mt-1">‚Ä¢</span>
              <span>Cross-reference with trusted fact-checkers</span>
            </li>
          </ul>

          <div>
            <p className="text-sm font-medium text-slate-400 mb-3">
              Try these example messages:
            </p>
            <div className="space-y-2">
              {exampleNotifications.map((example, idx) => (
                <button
                  key={idx}
                  type="button"
                  onClick={() => setNotification(example)}
                  className="w-full text-left p-3 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-700/50 hover:border-slate-600 transition-all duration-200"
                  disabled={analyzing}
                >
                  <p className="text-xs text-slate-300 line-clamp-2">
                    {example}
                  </p>
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>
    </section>
  );
}
